<?php

umask(0);

require('Mysqldump.php');

function db_export($server, $name, $user, $password){
    $dir = realpath(dirname(__FILE__));
    $dirExploit = realpath($dir . '/../../');
    $dirDump = $dirExploit . '/src/export';
    $dump = "{$dirDump}/dump.sql";

    if (!file_exists($dirDump)) {
        mkdir($dirDump, 0755, true);
    }
    touch($dump);
    chmod($dump, 0755);

    $mysqlDump = new Ifsnop\Mysqldump\Mysqldump(
        'mysql:host=' . $server . ';dbname=' . $name,
        $user,
        $password,
        array(
            'add-drop-table' => true
        )
    );
    $mysqlDump->start($dump);
}
