<?php

error_reporting(E_ALL);
ini_set('display_errors', 1);

header("Content-Type:text/html");

$dir = realpath(dirname(__FILE__));
$parameters = file_get_contents($dir . '/../../../.env');
$config = [];

$parameters = array_filter(array_map('trim', explode("\n", $parameters)));
foreach ($parameters as $item) {
    if (0 === strpos($item, '#')) {
        // commented string start with "#"
        continue;
    }

    $pieces = array_map('trim', explode('=', $item));
    if (2 !== count($pieces)) {
        continue;
    }

    list($key, $value) = $pieces;
    $config[$key] = trim($value, "\"'");
}

if (isset($_GET['action']) && 'import' == $_GET['action']) {
    require('import/functions.php');
    db_import($config['DATABASE_HOST'], $config['DATABASE_NAME'], $config['DATABASE_USER'], $config['DATABASE_PASSWORD']);
}
if (isset($_GET['action']) && 'export' == $_GET['action']) {
    require('export/functions.php');
    db_export($config['DATABASE_HOST'], $config['DATABASE_NAME'], $config['DATABASE_USER'], $config['DATABASE_PASSWORD']);
}
